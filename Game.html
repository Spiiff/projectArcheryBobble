<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <video id="test" width="800px" height="600px" controls="controls">
        <source id="video" src="./res/pexelsvideo.mp4"/>
    </video>
    <video id="webcam" width="800" height="600"></video>
    <button onclick="detectPose()">Analyse Video</button>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection"></script>

<canvas id="viewport" width="628" height="628"></canvas>

<script>
    var detector = null;
    var video = null;

    //check if webcam access is supported (new code)
    var enableWebcam = document.getElementById('webcam')

    function getUserMediaSupported() {
        return !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia);
    }

    if (getUserMediaSupported()) {
       enableCam();
    } else {
        console.warn('webcam not supported')
    }

    function enableCam() {

        const constraints = {
            video: true
        };
        navigator.mediaDevices.getUserMedia(constraints).then(function (stream) {
            enableWebcam.srcObject = stream;
            //video.addEventListener(predictWebcam);
        });
        // ---- new code end ----


        //video poses tracking
        document.addEventListener('DOMContentLoaded', async function () {
            detector = await poseDetection.createDetector(poseDetection.SupportedModels.MoveNet)
            // video = document.getElementById('test');  'video'
            video = document.getElementById('webcam');
        })
    }

    async function detectPose() {
        const poses = await detector.estimatePoses(video);

        console.log(poses)
    }
</script>

<script src='./archerybobble.js'></script>   <!-- type='text/javascript' -->
</body>
</html>